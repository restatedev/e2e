services:
  driver:
    image: ghcr.io/restatedev/e2e-node-services:main
    ports:
      - 3000:3000
    depends_on:
      restate:
        condition: service_started
    environment:
      NODE_ENV: production
      NODE_OPTIONS: "--max-old-space-size=4096"
      SERVICES: InterpreterDriverJob
      INTERPRETER_DRIVER_CONF: ${INTERPRETER_DRIVER_CONF}
    restart: "no"
  interpreter_zero:
    image: ghcr.io/restatedev/e2e-node-services:main
    ports:
      - 9000:9000
    environment:
      - PORT=9000
      - RESTATE_LOGGING=WARN
      - NODE_ENV=production
      - SERVICES=ObjectInterpreterL0
    restart: always
  interpreter_one:
    image: ghcr.io/restatedev/e2e-node-services:main
    ports:
      - 9001:9001
    environment:
      - PORT=9001
      - RESTATE_LOGGING=WARN
      - NODE_ENV=production
      - SERVICES=ObjectInterpreterL1
    restart: always
  interpreter_two:
    image: ghcr.io/restatedev/e2e-node-services:main
    ports:
      - 9002:9002
    environment:
      - PORT=9002
      - RESTATE_LOGGING=WARN
      - NODE_ENV=production
      - SERVICES=ObjectInterpreterL2,ServiceInterpreterHelper
    restart: always
  restate:
    image: ghcr.io/restatedev/restate:main
    ports:
      - 8080:8080
      - 9090:9090
      - 9070:9070
      - 8081:8081
    restart: "no"
    environment:
      - RESTATE_LOG_FILTER=restate=warn
      - RESTATE_LOG_FORMAT=json
    ulimits:
      nproc: 65535
      nofile:
        soft: 65535
        hard: 65535
